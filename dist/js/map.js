//在司机端中设置标题
function getLocation(){showPosition(null)}function gpsPosition(e){myPosition={lat:e.coords.latitude,lng:e.coords.longitude},showPosition(myPosition)}function showPosition(e){if(null===e){var n=util.getUrlParam("lat"),t=util.getUrlParam("lng");e=n&&t?{lat:n,lng:t}:DEFAULT_CENTER}else DEFAULT_CENTER=e;showMapWithCenter(e)}function showError(e){switch(e.code){case e.PERMISSION_DENIED:alert("User denied the request for Geolocation.");break;case e.POSITION_UNAVAILABLE:alert("Location information is unavailable.");break;case e.TIMEOUT:alert("The request to get user location timed out.");break;case e.UNKNOWN_ERROR:alert("An unknown error occurred.")}showPosition(null)}function getCurrentAdd(e){var n=new qq.maps.Geocoder({complete:function(e){CURRENT_ADDRESS=e.detail.address},error:function(){alert("出错了，请输入正确的经纬度！！！")}});n.getAddress(e)}function showMapWithCenter(e){e=e||DEFAULT_CENTER,renderMap(e,!0)}function renderMap(e,n){if(map=new qq.maps.Map(document.getElementById("container"),{center:new qq.maps.LatLng(e.lat,e.lng),zoom:16,zoomControl:!1,panControl:!1,mapTypeControl:!1,scaleControl:!1}),n){var t=new qq.maps.Marker({map:map,position:map.getCenter()});t.setIcon(new qq.maps.MarkerImage("images/icon_adr.png",null,null,null,new qq.maps.Size(25,30)))}showControllers(),showMarker(MAP_DATA.markers)}function markerClick(e,n){TARGET_POSITION={lat:e.getLat(),lng:e.getLng()};var t={start:DEFAULT_CENTER,end:TARGET_POSITION,address:n};showRouter(t)}function showMarker(e){for(var n=e.length-1;n>=0;n--){var t=new qq.maps.LatLng(e[n].lat,e[n].lng),o={id:n,name:e[n].name,categories:e[n].category,address:e[n].address},r=new CustomOverlay(t,o,markerClick);r.setMap(map)}}function bindLongPress(){var e,n;document.getElementById("container").addEventListener("touchstart",function(){e=(new Date).getTime()},!1),document.getElementById("container").addEventListener("touchend",function(){if(n=(new Date).getTime(),n-e>2e3){null==targetMarker?targetMarker=new qq.maps.Marker({map:map,icon:new qq.maps.MarkerImage("images/icon_adr.png",null,null,null,new qq.maps.Size(25,30)),position:new qq.maps.LatLng(TARGET_POSITION.lat,TARGET_POSITION.lng)}):(targetMarker.setPosition(new qq.maps.LatLng(TARGET_POSITION.lat,TARGET_POSITION.lng)),targetMarker.setVisible(!0));var t={start:DEFAULT_CENTER,end:TARGET_POSITION};showRouter(t)}},!1),qq.maps.event.addListener(map,"click",function(e){TARGET_POSITION={lat:e.latLng.getLat(),lng:e.latLng.getLng()}})}function showRouter(e){var n=new qq.maps.LatLng(e.start.lat,e.start.lng),t=new qq.maps.LatLng(e.end.lat,e.end.lng),o=e.policy||qq.maps.DrivingPolicy.REAL_TRAFFIC,r=e.address||"";null!=drivingService&&drivingService.clear(),drivingService=new qq.maps.DrivingService({}),drivingService.setPolicy(o),drivingService.setComplete(function(e){e.type==qq.maps.ServiceResultType.MULTI_DESTINATION&&alert("起终点不唯一");var n=e.detail,t=new qq.maps.Geocoder({complete:function(e){showRouterInfo(n.distance,n.duration,r||e.detail.address),$(".icon_restore").css({margin:"0px 5px 100px 0px"})},error:function(){alert("出错了，请输入正确的经纬度！！！")}});t.getAddress(e.detail.end.latLng)}),drivingService.setError(function(e){alert(e)}),drivingService.search(n,t)}function repaintRouter(e,n,t){var o=new qq.maps.LatLng(e.lat,e.lng),r=new qq.maps.LatLng(n.lat,n.lng);drivingService=new qq.maps.DrivingService({map:map}),drivingService.setPolicy(t||qq.maps.DrivingPolicy.REAL_TRAFFIC),drivingService.setComplete(function(e){e.type==qq.maps.ServiceResultType.MULTI_DESTINATION&&alert("起终点不唯一")}),drivingService.setError(function(e){alert(e)}),drivingService.search(o,r)}function showRouterInfo(e,n,t){if($(".ui_btm_box").show(),$(".ui_map_address").show(),$(".e_line").hide(),$(".target_address").html(t),e>1e3)var o="距离"+Math.round(e/100)/10+"公里";else var o="距离"+e+"米";$(".distance").html(o),$(".duration").html(n+"分钟"),$(".current_address").html(CURRENT_ADDRESS)}function shiftView(){showRoadCondition(!VIEW_TYPE),VIEW_TYPE=!VIEW_TYPE}function showRoadCondition(e){null==roadConditionLayer&&(roadConditionLayer=new qq.maps.TrafficLayer),e?roadConditionLayer.setMap(map):roadConditionLayer.setMap(null)}function submitAdvise(){var e=$.trim($(".e_submit_text").val());return""==e||null==e||void 0==e?($("#textEmpty").show(),void setTimeout(function(){$("#textEmpty").hide()},2e3)):void util.ajax({url:"../../bigdata/thermodynamic-chart.html",data:{feedback:e},success:function(e){$(".e_submit_text").val(""),$("#textOK").show(),$(".popup").hide(),$(".mask").hide(),setTimeout(function(){$("#textOK").hide()},2e3)}})}function showControllers(){var e=document.createElement("div");new CustomCenterControl(e,map);map.controls[qq.maps.ControlPosition.RIGHT_BOTTOM].push(e);var n=(new qq.maps.ScaleControl({align:qq.maps.ALIGN.LEFT_BOTTOM,map:map}),document.createElement("div"));new HelpControl(n,map);map.controls[qq.maps.ControlPosition.RIGHT_TOP].push(n);var t=document.createElement("div");new RoadConditionControl(t,map);map.controls[qq.maps.ControlPosition.RIGHT_TOP].push(t)}function CustomCenterControl(e,n){e.innerHTML="<i id='ctlBackToCenter' class='icon_restore'/></i>",e.onclick=function(){n.panTo(new qq.maps.LatLng(DEFAULT_CENTER.lat,DEFAULT_CENTER.lng))}}function HelpControl(e,n){$(e).addClass("icon_help icon_position"),e.onclick=function(){showHelpPage()}}function RoadConditionControl(e,n){$(e).addClass("icon_cdn_off icon_position"),e.onclick=function(){shiftView(),_this=$(this),_this.hasClass("icon_cdn_on")?_this.removeClass("icon_cdn_on").addClass("icon_cdn_off"):_this.removeClass("icon_cdn_off").addClass("icon_cdn_on")}}function CustomLegendControl(e,n){e.style.padding="10px",e.innerHTML="<p class='order_dtl'><b>单量峰值</b><em>单量较多</em></p>"}function playAudioTip(e){var n=document.getElementById("audio"),t={"订单较少":"1.ogg","订单较多":"2.ogg","订单很多":"3.ogg"};n.src=t[e],n.play()}function showHelpPage(){$(".popup").show(),$(".mask").show()}if(window.DriverBridge)try{window.DriverBridge.setWebViewTitle("订单热图")}catch(e){}var DEFAULT_CENTER={lat:31.231706,lng:121.472644},CURRENT_ADDRESS=null,POLYGON_STYLES=[{},{color:"#ffdc2f",opacity:"0.4",strokeColor:"#d2a028",strokeWeight:1},{color:"#fa973b",opacity:"0.5",strokeColor:"#d2a028",strokeWeight:1},{color:"#fe4b48",opacity:"0.5",strokeColor:"#cd703c",strokeWeight:1},{color:"#fe4b48",opacity:"0.7",strokeColor:"#cd703c",strokeWeight:1},{color:"#fe4b48",opacity:"0.9",strokeColor:"#cd703c",strokeWeight:1}],DEFAULT_POLYGON_STYLES={color:"#fe4b48",opacity:"0.5",strokeColor:"#cd703c",strokeWeight:1};POLYGON_RATE=1e6;var map,markerArr=[],polyArr=[],VIEW_TYPE=!1,roadConditionLayer=null,drivingService=null,TARGET_POSITION=null,targetMarker=null;getLocation();